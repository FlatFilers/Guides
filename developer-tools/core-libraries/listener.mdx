---
title: "@flatfile/listener"
description: "Call our API after receiving events from any PubSub driver."
---

## Overview

The Flatfile **PubSub Client** is a super thin wrapper around the Flatfile API. It allows you to call our API after receiving events from any PubSub driver. 

**The default drivers are:**

- Webhook    (for simply processing events sent to URL)
- Websocket  (for subscribing real time on an HTTP2 connection)
- Serverless (for stateless invocations via AWS Lambda or similar)

Once an event is received, it is routed to any awaiting listeners which are added with `addEventListener()` or its alias `on()`.

Flatfile events follow a standard structure and event listeners can use any of the following syntaxes to react to events within Flatfile.

### Before you begin

The minimum supported version of Node.js is v18. If you use an older version, upgrade to use this library. 

Check your versions in terminal:

```npm
node --version
```

#### Concepts

Take a moment to learn event-related Flatfile architecture. This will help orient yourself before you begin building.

An **Agent** is a “coordinator” that watches for events it cares about and then says “ok now perform this work”.

A **Job** is a batch of work that you schedule to be completed asynchronously. Processing data asynchronously is necessary when the data is too big to wait around for the API to come back with a response.

An **Event** is a moment in time in a stream of events that happen in Flatfile.

An **Event context** is the specific scope within an event, we may not want to respond to events that happen globally under our account (because ultimately that would be too noisy!) we may just want to listen to events within a workbook or a single sheet.

#### Setup

Install Listener from the npm public registry.

```npm
npm install @flatfile/listener@latest
```
```yarn
yarn install @flatfile/listener@latest
```

#### Usage

Using our powerful [@flatfile/listener](https://www.npmjs.com/package/@flatfile/listener) library we can intervene between any event and run a callback function based on values provided inside that event.

The following is a list of events you can subscribe to:

```typescript

declare const EventTopic: {
   readonly Spaceadded: "space:added";
   //see full reference below
}

```

An event context is passed to an **EventFilter**

```typescript
export type EventFilter = Record<string, Arrayable<string>>

// example event context

{ context: { sheetSlug: 'TestSheet' } }

```

### Event Topic Reference

#### Space

<ParamField path="space:added" type="readonly">
  Called when a Space is created
</ParamField>

<ParamField path="space:removed" type="readonly">
  Called when a Space is deleted
</ParamField>

#### Workbook

<ParamField path="workbook:added" type="readonly">
  Called when a Space is created
</ParamField>

<ParamField path="workbook:removed" type="readonly">
  Called when a Workbook is deleted
</ParamField>

<ParamField path="sheet:validated" type="readonly">
  Called when a sheet is validated
</ParamField>

<ParamField path="records:created" type="readonly">
  Called when a records are created
</ParamField>

<ParamField path="records:updated" type="readonly">
  Called when a records are updated
</ParamField>

<ParamField path="records:deleted" type="readonly">
  Called when records are deleted
</ParamField>

#### User

<ParamField path="user:added" type="readonly">
  Called when a User is created
</ParamField>

<ParamField path="user:removed" type="readonly">
  Called when a User is deleted
</ParamField>

<ParamField path="user:online" type="readonly">
  Called when a User logs in
</ParamField>

<ParamField path="user:offline" type="readonly">
  Called when a User logs out
</ParamField>

#### File Upload

<ParamField path="upload:started" type="readonly">
  Called when a file upload begins
</ParamField>

<ParamField path="upload:failed" type="readonly">
  Called when a file upload fails
</ParamField>

<ParamField path="upload:completed" type="readonly">
  Called when a file upload has compled
</ParamField>

<ParamField path="file:deleted" type="readonly">
  Called when a file is deleted
</ParamField>

#### Jobs

<ParamField path="job:waiting" type="readonly">
  Called when a job is waiting to begin
</ParamField>

<ParamField path="job:started" type="readonly">
  Called when a job begins
</ParamField>

<ParamField path="job:updated" type="readonly">
  Called when a job is updated, oftentimes for progress
</ParamField>

<ParamField path="job:failed" type="readonly">
  Called when a job fails
</ParamField>

<ParamField path="job:completed" type="readonly">
  Called when a job has compled
</ParamField>

<ParamField path="job:deleted" type="readonly">
  Called when a job is deleted
</ParamField>

#### Actions

<ParamField path="action:triggered" type="readonly">
  Called when an action is triggered in the UI
</ParamField>

#### Agents

<ParamField path="client:init" type="readonly">
  Called when an agent is deployed
</ParamField>



### Debugging

**Not seeing your hooks / actions / events fire? Check the following:**

- Any network request errors?
- Does your event exist inside [EventTopic](href=#what-is-a-flatfile-event)?
- Does your event that you are listening for match the one that is being logged?
- Does your context value match what is being console logged?
- Are populated values coming back for records?
- Does your action name match the name you passed inside your config?
