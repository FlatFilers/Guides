---
title: "Embed a new Space"
description: "Create a new Space every time Flatfile is opened."
icon: "plus"
---

For instances where you want to embed an existing space each time Flatfile is opened. This suits where a single space of collective data is preferred.

## Before you begin

<Snippet file="shared/pk_needed.mdx" />

Also note, this guide is made with [Next.js](https://nextjs.org/) as the context. This requires more up front configuration than React, but is an all-in-one package for your frontend and backends.

## Prepare your project

```bash
mkdir example-flatfile-next-embed
```

Go into that directory.

```bash
cd example-flatfile-react-embed
```

Follow prompts from the `init` command.

```bash
npm init
```

Install packages.

```bash
npm i react react-dom postcss tailwindcss typescript next eslint eslint-config-next autoprefixer @types/node @types/react @types/react-dom @flatfile/api @flatfile/listener @flatfile/react && npm i --save-dev daisyui
```

### Create your file structure

Setup your app to look something like this:

```
├── app/
   ├── globals/
      ├── global.css
      ├── Menu.tsx
      └── page.module.css
   ├── new-space/
      ├── NewSpaceApp.tsx
      └── page.tsx
   ├──layout.tsx
   └── page.tsx
├── listeners/
   └── basic.ts
├── pages/
├── workbooks/
   └── workbook.ts
├── .env
├── .gitignore
├── .nvmrc
├── next-env.d.ts
├── next.config.js
├── package.json <--- already created
├── package-lock.json <--- already created
├── postcss.config.js
├── tailwind.config.js
└── tsconfig.json

```

<Info>
  Note: `app/new-space/*` is optional if you don't want to create new spaces at
  all in your application and only want to use existing spaces. You can feel
  free to skip that portion of the guide if it does not fit your use-case. You
  can also configure a tsconfig.paths.json if you desire aliases in your
  imports, however this guide will not be utilizing this feature.
</Info>

## Build your Importer

### 1. Set up the Configuration Files

There are a few config files that must be set up before next.js can run. These include the configuration for nextjs, as well as all the associated technologies. Included below is the recommended contents of these files. This guide uses tailwindcss for styles, however if your application uses a different pre/post processor your configuration may vary.

<CodeGroup>

```bash .env
  # A secret key is necessary to fetch existing spaces.
  FLATFILE_API_KEY=your_secret_key
```

```gitignore .gitignore
  ### Node template
  # Editors
  .idea
  .vscode
  .editorconfig

  # Logs
  logs
  *.log
  npm-debug.log*
  yarn-debug.log*
  yarn-error.log*
  lerna-debug.log*

  # Turbo
  .turbo

  # Build output
  build/**
  dist/**

  # Diagnostic reports (https://nodejs.org/api/report.html)
  report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json

  # Runtime data
  pids
  *.pid
  *.seed
  *.pid.lock

  # Directory for instrumented libs generated by jscoverage/JSCover
  lib-cov

  # Coverage directory used by tools like istanbul
  coverage
  *.lcov

  # nyc test coverage
  .nyc_output

  # Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
  .grunt

  # Bower dependency directory (https://bower.io/)
  bower_components

  # node-waf configuration
  .lock-wscript

  # Compiled binary addons (https://nodejs.org/api/addons.html)
  build/Release

  # Dependency directories
  node_modules/
  jspm_packages/

  # Snowpack dependency directory (https://snowpack.dev/)
  web_modules/

  # TypeScript cache
  *.tsbuildinfo

  # Optional npm cache directory
  .npm

  # Optional eslint cache
  .eslintcache

  # Microbundle cache
  .rpt2_cache/
  .rts2_cache_cjs/
  .rts2_cache_es/
  .rts2_cache_umd/

  # Optional REPL history
  .node_repl_history

  # Output of 'npm pack'
  *.tgz

  # Yarn Integrity file
  .yarn-integrity

  # dotenv environment variables file
  .env
  .env.test

  # parcel-bundler cache (https://parceljs.org/)
  .cache
  .parcel-cache

  # Next.js build output
  .next
  out

  # Nuxt.js build / generate output
  .nuxt
  dist

  # Gatsby files
  .cache/
  # Comment in the public line in if your project uses Gatsby and not Next.js
  # https://nextjs.org/blog/next-9-1#public-directory-support
  # public

  # vuepress build output
  .vuepress/dist

  # Serverless directories
  .serverless/

  # FuseBox cache
  .fusebox/

  # DynamoDB Local files
  .dynamodb/

  # TernJS port file
  .tern-port

  # Stores VSCode versions used for testing VSCode extensions
  .vscode-test

  # yarn v2
  .yarn/cache
  .yarn/unplugged
  .yarn/build-state.yml
  .yarn/install-state.gz
  .pnp.*

  # MacOS
  .DS_Store

  # Flatfile
  .flatfile
  .flatfilerc.json

  *.code-workspace
```

```txt .nvmrc
v18
```

```TypeScript next-env.d.ts
  /// <reference types="next" />
  /// <reference types="next/image-types/global" />
  /// <reference types="next/navigation-types/compat/navigation" />

  // NOTE: This file should not be edited
  // see https://nextjs.org/docs/basic-features/typescript for more information.
```

```JavaScript next.config.js
  /** @type {import('next').NextConfig} */
  const nextConfig = {}

  module.exports = nextConfig
```

```JavaScript postcss.config.js
  module.exports = {
    plugins: ["tailwindcss", "autoprefixer"],
  };
```

```JavaScript tailwind.config.js
  /** @type {import('tailwindcss').Config} */
  module.exports = {
    content: [
      "./app/**/*.{js,ts,jsx,tsx,mdx}",
      "./pages/**/*.{js,ts,jsx,tsx,mdx}",
      "./components/**/*.{js,ts,jsx,tsx,mdx}",

      // Or if using `src` directory:
      "./src/**/*.{js,ts,jsx,tsx,mdx}",
    ],
    theme: {
      extend: {},
    },
    plugins: [require("daisyui")],
  };
```

```json tsconfig.json
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

</CodeGroup>

### 2. Create your Basic Page and Layout

Your `app/page.tsx` and `app/layout.tsx` files are the heart of your application, where your users will be interacting with the flatfile embed. Below will be our recommended configurations of these files, however these are fairly flexible and can change greatly based on your own use-cases.

It is also recommended you set up your `app/globals/global.css`, `app/globals/page.module.css`, and `app/globals/Menu.tsx` files at this time, as they will be required on every page.

<CodeGroup>

```CSS app/globals/global.css
  @tailwind base;
  @tailwind components;
  @tailwind utilities;

  :root {
    --ff-primary-color: #4c48ef !important;
    --ff-secondary-color: #616a7d !important;
    --ff-text-color: #090b2b !important;
    --ff-dialog-border-radius: 4px !important;
    --ff-border-radius: 5px !important;
    --ff-bg-fade: rgba(0, 0, 0, 0.2) !important;
  }

  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: sans-serif;
    background: var(--ff-text-color);
    color: #fff;
  }

  pre {
    display: inline;
  }

  /* This class gets appended to the flatfile_iframe-wrapper div */
  .flatfile_displayAsModal {
    padding: 50px !important;
    width: calc(100%) !important;
    height: calc(100vh) !important;
  }

  .flatfile_iframe-wrapper.flatfile_displayAsModal {
    background: var(--ff-bg-fade);
  }

  /* The close button in top right to close modal */
  /* .flatfile_displayAsModal .flatfile_close-button {
    } */
  .flatfile_displayAsModal .flatfile-close-button {
    top: 30px;
    right: 30px;
  }
  /* The icon for the close button in top right to close modal */
  .flatfile_displayAsModal .flatfile_close-button svg {
    fill: var(--ff-secondary-color);
  }

  /* The actual iframe that contains Flatfile */
  .flatfile_displayAsModal #flatfile_iframe {
    border-radius: var(--ff-border-radius);
  }

  /* Begin style overrides for when you cancel out of the Flatfile modal */

  /* The outer container of the modal that opens when you cancel out of Flatfile */
  .flatfile_outer-shell {
    background-color: var(--ff-bg-fade);
    border-radius: var(--ff-border-radius);
  }

  /* The inner container of the modal that opens when you cancel out of Flatfile */
  /* .flatfile_inner-shell {
    } */

  /* The white box inside the modal that opens when you cancel out of Flatfile */
  .flatfile_modal {
    border-radius: var(--ff-dialog-border-radius);
  }

  /* The container for the buttons you see in the close modal */
  /* .flatfile_button-group {
    } */

  /* Style the buttons you see in the close modal */
  /* .flatfile_button {
    } */

  /* The "yes, cancel" button you see in the close modal */
  .flatfile_primary {
    border: 1px solid var(--ff-primary-color) !important;
    background-color: var(--ff-primary-color) !important;
    color: #fff !important;
  }

  /* The "no, stay" button you see in the close modal */
  .flatfile_secondary {
    color: var(--ff-secondary-color) !important;
  }

  /* The heading text you see in the close modal */
  .flatfile_modal-heading {
    color: var(--ff-text-color) !important;
  }

  /* The description text you see in the close modal */
  .flatfile_modal-text {
    color: var(--ff-secondary-color) !important;
  }

  .alert a {
    text-decoration: underline;
  }

  /* End style overrides for when you cancel out of the Flatfile modal */

  /* End style overrides for when Flatfile is displayed as a modal */

  /* The container of the error component */
  /* .ff_error_container {
    }*/

/* The heading text you see in the error component */
/* .ff_error_heading {
  }*/

  /* The description text you see in the error component */
  /* .ff_error_text {
    }*/
```

```JSX app/globals/Menu.tsx
  "use client";
  import styles from "./page.module.css";
  import Link from "next/link";
  import "./global.css";
  import { usePathname } from "next/navigation";

  const routes = [{ path: "/new-space", label: "New Space" }];

  export default function Menu() {
    const currentRoute = usePathname();
    return (
      <div className={styles.menu}>
        <h2>
          <Link href="/">
            <code>&lt;Flatfile /&gt;</code>
          </Link>
        </h2>
        <div className="tabs">
          {routes.map(({ path, label }) => (
            <Link
              key={path}
              href={path}
              className={`tab tab-bordered ${
                currentRoute === path ? "tab-active" : ""
              }`}
            >
              {label}
            </Link>
          ))}
        </div>
      </div>
    );
  }
```

```JSX app/layout.tsx
  import "./globals/global.css";
  import Menu from "./globals/Menu";

  export const metadata = {
    title: "Embedded Flatfile in a Next.js App",
    description: "Generated by Flatfile",
  };

  export default function RootLayout({
    children,
  }: {
    children: React.ReactNode;
  }) {
    return (
      <html lang="en">
        <body>
          <Menu />
          <div className="max-w-6xl mx-auto">{children}</div>
        </body>
      </html>
    );
  }
```

```CSS app/globals/page.module.css
  /* Styles for home page */
  .menu {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    padding: 15px;
    position: absolute;
    width: 100%;
  }

  /* The default mount element */
  /* #flatfile_iFrameContainer {
    } */

  /* A div around the iframe that contains Flatfile */
  /* .flatfile_iframe-wrapper {
    } */

  /* The actual iframe that contains Flatfile */
  /* #flatfile_iframe {
    } */

  /* Begin style overrides for when Flatfile is displayed as a modal */
```

```JSX app/page.tsx
  "use client";
  import React from "react";
  import styles from "./globals/page.module.css";
  import Link from "next/link";

  export default function Home() {
    return (
      <div className="hero min-h-screen">
        <div className="hero-content text-center">
          <div className="max-w-2xl">
            <h1 className="text-5xl font-bold">
              Welcome to Flatfile! <br /> We're glad you're here! 🤩
            </h1>
            <p className="py-6">
              This app will show you a few examples of how to integrate Embedded
              Flatfile into your React workflow. First, we'll show you how to
              create a new Space every time Flatfile is opened. Then, we'll show
              you how to reuse a Space when Flatfile is opened.
            </p>
            <Link href="/new-space">
              <button className="btn btn-primary">
                Get Started Creating a New Space
              </button>
            </Link>
          </div>
        </div>
      </div>
    );
  }
```

</CodeGroup>

### 3. Create the Scripts to Start and Build your App

At this point in the guide you should be able to start your application without errors. However, you will need to update your `package.json` to be able to start it.

update your `package.json` to include this script:

```json
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
```

Now you can start your application by running these in the CLI. However, your application still doesn't have the desired functionalities, and your menu links won't lead anywhere.

### 4. Build a workbook

In order to create a new space, you'll need a workbook to build in it.

Build a workbook at `workbooks/workbook.ts` that looks something like this:

```TypeScript workbooks/workbook.ts
  import { Flatfile } from "@flatfile/api";

  export const workbook: Pick<
    Flatfile.CreateWorkbookConfig,
    "name" | "sheets" | "actions"
  > = {
    name: "Employees workbook",
    sheets: [
      {
        name: "TestSheet",
        slug: "TestSheet",
        fields: [
          {
            key: "first_name",
            type: "string",
            label: "First name",
            constraints: [
              {
                type: "required",
              },
            ],
          },
          {
            key: "last_name",
            type: "string",
            label: "last name",
          },
          {
            key: "full_name",
            type: "string",
            label: "full name",
          },
        ],
        actions: [
          {
            label: "Join fields",
            operation: "contacts:join-fields",
            description: "Would you like to join fields?",
            mode: "foreground",
            confirm: true,
          },
        ],
      },
    ],
    actions: [
      {
        label: "Submit",
        operation: "contacts:submit",
        description: "Would you like to submit your workbook?",
        mode: "foreground",
        primary: true,
        confirm: true,
      },
    ],
  };
```

### 5. Build your New Space Component

If you want to be able to create new spaces from your app, update your `app/new-space/NewSpaceApp.tsx` and `app/new-space/page.tsx` files to the following, replacing empty key/id strings with your credentials associated with them:

<CodeGroup>

```JSX app/new-space/NewSpaceApp.tsx
  "use client";
  import React, { Dispatch, SetStateAction, useState } from "react";
  import { ISpace, useSpace } from "@flatfile/react";
  import Link from "next/link";

  const Space = ({
    callback,
    config,
  }: {
    callback: () => void;
    config: ISpace;
  }) => {
    const space = useSpace({
      ...config,
      closeSpace: {
        operation: "contacts:submit",
        onClose: () => callback(),
      },
    });
    return space;
  };

  export default function App({ config }: { config: ISpace }) {
    const [showSpace, setShowSpace] = useState(false);
    const [success, setSuccess] = useState(false);
    const credentials = !!config.publishableKey && !!config.environmentId;
    return (
      <div>
        {credentials ? (
          <>
            <div>
              <button
                className="btn btn-primary"
                onClick={() => {
                  setShowSpace(!showSpace);
                }}
              >
                {showSpace === true ? "Close" : "Open and create new"} space
              </button>
            </div>
            {showSpace && (
              <div id="flatfile_iFrameContainer">
                <Space
                  callback={() => {
                    setShowSpace(false);
                    setSuccess(true);
                  }}
                  config={config}
                />
              </div>
            )}
          </>
        ) : (
          <div className="alert alert-error">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="stroke-current shrink-0 h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
                d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span>
              Error! Please add your <pre>publishableKey</pre> and{" "}
              <pre>environmentId</pre>
            </span>
          </div>
        )}
        {success && (
          <div className="alert alert-success mt-6">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="stroke-current shrink-0 h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span>
              Great Success! Now you might want to try out reusing a space,{" "}
              <Link href="/reused-space">check out the next example here.</Link>
            </span>
          </div>
        )}
      </div>
    );
  }
```

```JSX app/new-space/page.tsx
  "use client";
  import React from "react";
  import { ISpace } from "@flatfile/react";
  import { listener } from "../../listeners/basic";
  import { workbook } from "../../workbooks/workbook";
  import NewSpaceApp from "./NewSpaceApp";

  const spaceProps: ISpace = {
    name: "Embedded Space",
    // to test locally add your publishableKey here, for example: pk_12345,
    publishableKey: "",
    // to test locally add your environmentId here, for example: us_env_12345,
    environmentId: "",
    workbook,
    listener: listener,
    // themeConfig: makeTheme({ primaryColor: "#546a76", textColor: "#fff" }),
    // sidebarConfig: {
    //   showDataChecklist: false,
    //   showSidebar: false,
    // },
  };

  export default function Home() {
    return (
      <div className="container px-20 pt-20">
        <h2 className="text-2xl font-bold mb-4">
          Embed a new Space every time Flatfile is opened
        </h2>
        <p>
          Reuse a Space when users might need to wait or can’t finish in one go.
          It’s great for keeping work context and letting users continue where
          they left off until the task is done.
        </p>
        <div className="py-10">
          <NewSpaceApp config={spaceProps} />
        </div>
      </div>
    );
  }
```

</CodeGroup>

### 6. Build your New Space Component

You will also want to create the listener imported into `app/new-space/page.tsx` to handle data when creating the space.

For more information on customizing listeners and handling data, read our documentation about [handling data](https://flatfile.com/docs/guides/handling-data).

You can also use this code as a template for your listener:

```TypeScript listeners/basic.ts
  import { FlatfileListener } from "@flatfile/listener";
  import { recordHook } from "@flatfile/plugin-record-hook";

  /**
  * Example Listener
  */
  export const listener = FlatfileListener.create((client) => {
    client.use(
      recordHook("TestSheet", (record) => {
        const last_name = record.get("last_name");
        console.log("passing through record hook", last_name);
        if (!last_name) {
          console.log("last_name is required");
          record.addError("last_name", "Name is required");
        }
        return record;
      })
    );
  });
```

Now your app should be able to go to the new-space page and create new spaces.

### 7. Add customizations

You can stop here or you can [view our full reference](../reference/common) to see all the ways you can customize your importer.

## Example Project

Find this React example project in the Flatfile GitHub repository.

<CardGroup cols={1}>
  <Card
    title="flatfile-nextjs"
    icon="js"
    href="https://github.com/FlatFilers/flatfile-nextjs"
  >
    Clone the Flatfile Next tutorial here.
  </Card>
</CardGroup>
