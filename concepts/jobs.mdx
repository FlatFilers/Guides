---
title: "Jobs"
description: "The anatomy of Jobs"
icon: "truck"
---

In Flatfile, a Job represents a large unit of work performed asynchronously on a resource
such as a file, <Tooltip tip="Analogous to a database...">[Workbook](../concepts/workbooks)</Tooltip>,
or <Tooltip tip="A collection of fields...">[Sheet](../blueprint/overview#terms)</Tooltip>.
The Jobs workflow provides visibility into the status and progress of your Jobs,
allowing you to monitor and troubleshoot the data processing pipeline.

## Types of Jobs

Jobs can be triggered in a number of ways, most commonly in response to user activity.
Jobs are then managed via [Listeners](/concepts/listeners), which receive [Events](/concepts/events) published by Flatfile in response to activity.

There are three types of Jobs on the Flatfile Platform:

<CardGroup cols={3}>
  <Card title="Action Jobs" icon="bolt" href="/concepts/jobs#action-based-jobs">
    Attached to custom actions
  </Card>
  <Card title="Custom Jobs" icon="code" href="/concepts/jobs#custom-jobs">
    Created dynamically in your listener
  </Card>
  <Card title="System Jobs" icon="gears" href="/concepts/jobs#system-jobs">
    Flatfile system jobs
  </Card>
</CardGroup>

### Action Based Jobs

Actions are developer-defined operations that can be mounted on a number of domains (including Sheets, Workbooks, Documents, and Files).
Mounting an Action means attaching a custom operation to that domain.
That operation can then be triggered by a user event (clicking a button or selecting a menu item).

<Note>
  When an Action is triggered a `job:ready` Event for a Job named
  `[domain]:[operation]` is published. Your [Listener](/concepts/listeners) can
  then be configured to respond to that Action via it's Event.
</Note>

To run an Action based job, two configurations are necessary.

First, create an [Action](/concepts/actions) on a domain. Here's an example of a Workbook containing an Action:

```jsx javascript
api.workbook.create({
  name: "October Report Workbook",
  actions: [
    {
      label: "Export Data",
      description: "Send data to destination system",
      operation: "export",
      type: "file",
    },
  ],
});
```

Then, create a [Listener](/concepts/listeners) to respond to the Action:

```jsx javascript
listener.on(
  "job:ready",
  { job: "workbook:export" },
  ({ context: { jobId } }, payload) => {
    const { jobId } = event.context;

    try {
        await api.jobs.ack(jobId, {
          info: "Starting submit job...",
          progress: 10,
        });

        // Custom code here

        await api.jobs.complete(jobId, {
          outcome: {
            message: "Submit Job was completed succesfully.",
          },
        });

    } catch (error) {
        await api.jobs.fail(jobId, {
          outcome: {
            message: "This Job failed.",
          },
        });
    }
  }
);
```

Note that the Listener is listening for the `job:ready` event, for the `workbook:export` Job, which was defined in our Workbook.

### Custom Jobs

Another trigger option is to create a Custom Job via SDK/API. In the SDK, Jobs are created by calling the `api.jobs.create()` method.

Creating a custom Job in your Listener enables any Event to trigger a Job.

Here's an example of creating a custom Job in a Listener:

```jsx javascript
listener.on(
  "commit:created",
  { sheet: "contacts" },
  async ({ context: { workbookId, sheetId } }) => {
    const { data } = await api.jobs.create({
      type: "workbook",
      operation: "myCustomOperation",
      trigger: "immediate",
      source: workbookId,
      config: {
        sheet: sheetId,
        filter: "all",
      },
    });
  }
);
```

Note that the trigger for this Listener is set to immediate, which means that the Job will be created and executed immediately upon the Event firing.

Therefore, we should have our Listener ready to respond to this Job:

```jsx javascript
listener.on(
  "job:ready",
  { job: "workbook:myCustomOperation" },
  async ({ context: { jobId, workbookId }, payload }) => {
    try {
      await api.jobs.ack(jobId, {
        info: "Starting my cutom operation.",
        progress: 10,
      });

      // Custom code here.

      await api.jobs.complete(jobId, {
        outcome: {
          message: "Sucessfully completed my custom operation.",
        },
      });
    } catch {
      await api.jobs.fail(jobId, {
        outcome: {
          message: "Custom operation failed.",
        },
      });
    }
  }
);
```

<Warning>
  Please note that Flatfile does not support Job plans for custom Actions.
</Warning>

### System Jobs

Internally, Flatfile uses Jobs to power many of the features of the Flatfile Platform, such as extraction, record mutation, and AI Assist.
Here are some examples of Jobs that the Flatfile Platform creates and manages on your behalf:

| Job Name      | Description                                                   |
| ------------- | ------------------------------------------------------------- |
| Extract       | Extracts data from the specified source.                      |
| Map           | Maps data from it's ingress format to Blueprint fields.       |
| DeleteRecords | Deletes records from a dataset based on specified criteria.   |
| Export        | Exports data to a specified format or destination.            |
| MutateRecords | Alters records in a dataset according to defined rules.       |
| Configure     | Sets up or modifies the configuration of a Space.             |
| AiAssist      | Utilizes AI to assist with tasks such as data categorization. |
| FindReplace   | Searches for specific values and replaces them.               |

<Note>
  The`space:configure` Job is the only system-level Job published for developer
  consumption. This is a special Job that allows developers to configure their
  Spaces dynamically. See our [Space
  Configuration](/guides/dynamic-configurations) documentation for more
  information.
</Note>

## The Anatomy of a Job

### Status

A Job's status can be used to track and handle a Job. The status of a Job can be one of the following:

| Status    | Description                                                                         |
| --------- | ----------------------------------------------------------------------------------- |
| Created   | The initial status when a Job is created.                                           |
| Ready     | A Job is prepared to execute.                                                       |
| Executing | The Job has been acknowledged by a Listener and is now executing.                   |
| Completed | The Job has been completed.                                                         |
| Failed    | The Job encountered an error during execution and can't complete its assigned task. |
| Canceled  | The Job has been cancelled                                                          |

### Lifecycle Events

Jobs fire the following Events during their lifecycle. In chronological order, the Job Events are:

| Event                           | Description                                                                                                                                                                        |
| ------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `job:created`                   | Fires when a Job is created, but before it does anything.                                                                                                                          |
| `job:ready`                     | Fires when a Job is ready to move into the execution stage, but before it does anything.                                                                                           |
| `job:updated`                   | Fires when there is an update to a Job while it is executing.                                                                                                                      |
| `job:completed` OR `job:failed` | `job:completed` fires when a Job is completed successfully, `job:failed` fires if a Job is completed but fails. One of these events will fire upon Job completion, but never both. |
| `job:outcome-acknowledged`      | Fires when a user acknowledges the completion of a Job through a UI popup.                                                                                                         |

You can listen on any of these events in your [Listener](/concepts/listeners), but the most common event to listen for is `job:ready`.
For more on managing your Job see [Working With Jobs](#working-with-jobs).

### Configuration

Flatfile Jobs are versitile and configurable. The potential set of properties for a Job are:

| Property                                              | Required | Description                                                                                                  |
| ----------------------------------------------------- | -------- | ------------------------------------------------------------------------------------------------------------ |
| type                                                  | Required | `file`, `workbook`, `sheet`, `space`, `document`                                                             |
| fromAction:label                                      | Required | A user-friendly name for the action.                                                                         |
| fromAction:description                                | Optional | A string describing the action.                                                                              |
| fromAction:tooltip                                    | Optional | Additional info on hover.                                                                                    |
| fromAction:schedule                                   | Optional | `weekly`, `daily`, `hourly`                                                                                  |
| fromAction:operation                                  | Optional | The operation to perform.                                                                                    |
| fromAction:mode                                       | Optional | `foreground`, `background`, `toolbarBlocking`                                                                |
| fromAction:primary                                    | Optional | Whether this action is considered the primary or default action.                                             |
| fromAction:confirm                                    | Optional | Whether user confirmation is required before the action is executed.                                         |
| fromAction:icon                                       | Optional | Icon representative of the action.                                                                           |
| fromAction:inputForm:type                             | Required | `simple`                                                                                                     |
| fromAction:inputForm:fields:key                       | Required | The unique identifier for the input field.                                                                   |
| fromAction:inputForm:fields:label                     | Required | The display label for the input field.                                                                       |
| fromAction:inputForm:fields:description               | Optional | A brief description or guidance for the input field.                                                         |
| fromAction:inputForm:fields:type                      | Required | `string`, `textarea`, `number`, `boolean`, `enum`                                                            |
| fromAction:inputForm:fields:config:options:value      | Required | The value for the configuration option of the input field.                                                   |
| fromAction:inputForm:fields:config:options:label      | Optional | The label for the configuration option of the input field.                                                   |
| fromAction:inputForm:fields:config:options:descripion | Optional | A description for the configuration option of the input field.                                               |
| fromAction:inputForm:fields:config:options:color      | Optional | The color associated with the configuration option, if applicable.                                           |
| fromAction:inputForm:fields:config:options:icon       | Optional | The icon associated with the configuration option.                                                           |
| fromAction:inputForm:fields:config:options:meta       | Optional | Additional metadata for the configuration option.                                                            |
| fromAction:inputForm:fields:constraints:type          | Required | `hasSelection`, `hasAllValid`                                                                                |
| operaton                                              | Required | The operation to perform on the data. This can be anything as long as a correlating listener is handling it. |
| source                                                | Required | The id of the data source (FileId, WorkbookId, or SheetId).                                                  |
| destination                                           | Optional | The id of the data target. (WorkbookId)                                                                      |
| input                                                 | Optional | Input parameters for the Job type.                                                                           |
| subject:resource                                      | Required | Identifier for the subject resource.                                                                         |
| subjet:type                                           | Required | `resource`, `collection`                                                                                     |
| subjet:query                                          | Optional | The query used to locate or identify the subject resource.                                                   |
| subjet:params                                         | Optional | Parameters that detail or modify the subject query.                                                          |
| outcome:heading                                       | Optional | The heading text summarizing the outcome of the action.                                                      |
| outcome:acknowledge                                   | Optional | Indicates if the outcome requires user acknowledgment.                                                       |
| outcome:message                                       | Optional | Detailed message describing the outcome.                                                                     |
| outcome:buttonText                                    | Optional | Label for the button to acknowledge the outcome.                                                             |
| outcome:next:type                                     | Optional | The type of subsequent action to take after the current Job completes.                                       |
| outcome:next:id                                       | Optional | Identifier for the subsequent action to take after the current Job completes.                                |
| outcome:next:label                                    | Optional | Label for the subsequent action to take after the current Job completes.                                     |
| info                                                  | Optional | Additional information regarding the job's current status.                                                   |
| managed                                               | Optional | Indicates whether the Job is managed by the Flatfile platform or not.                                        |
| config:filter                                         | Optional | Definition of filtering conditions to apply to Job records.                                                  |
| config:filterField                                    | Optional | The specific field upon which the filter should be applied.                                                  |
| config:searchValue                                    | Optional | The value to be used in search operations within the job's dataset.                                          |
| config:searchField                                    | Optional | The field to be used as a reference point in search operations within the job's dataset.                     |
| config:q                                              | Optional | The Flatfile Query Language                                                                                  |
| config:sheet                                          | Required | The unique identifier for the sheet within the Job context.                                                  |
| config:exceptions                                     | Optional | A list of record identifiers that should be excluded from the Job process.                                   |
| trigger                                               | Optional | `mannual`, `immediate`                                                                                       |
| status                                                | Optional | `created`, `planning`, `scheduled`, `ready`, `executing`, `complete`, `failed`, `cancelled`                  |
| mode                                                  | Optional | `foreground`, `background`, `toolbarBlocking`                                                                |
| progress                                              | Optional | A numerical or percentage value indicating the completion status of the job.                                 |
| fileId                                                | Optional | The identifier for the file associated with the Job, if applicable.                                          |
| environmentId                                         | Optional | The identifier for the environment in which the Job is running.                                              |

Please see our [API Reference](https://reference.flatfile.com/docs/api) for details on all possible values.

## Working With Jobs

Jobs can be managed via SDK/API. For a complete list of ways to interact with Jobs please see our [API Reference](https://reference.flatfile.com/docs/api) . Commonly, Jobs are acknowledged, progressed, and then completed, or failed. Here's look at those setps.

### Jobs.Ack

First, acknowledge a Job. This will update the Job's status to `executing`.

```jsx javascript
await api.jobs.ack(jobId, {
  info: "Starting submit job...",
  progress: 10,
});
```

### Jobs.Update

Once a Job is acknowledged, you can begin running your custom operation. Jobs were designed to handle large procesing loads, but you can easily update your user by updating the Job with a progress value.

```jsx javascript
await api.jobs.update(jobId, {
  progress: 50,
  estimatedCompletionAt: new Date("Tue Aug 23 2023 16:19:42 GMT-0700"),
});
```

`Progress` is a numerical or percentage value indicating the completion status of the work.
You may also provide an `estimatedCompletionAt` value which will display your estimate of the remaining processing time in the foreground Job overlay.
Additionally, the Jobs Panel will share visibility into the estimated remaining time for acknowledged jobs.

<img src="../images/jobs/estimatedtime_actions.png" caption="estimated time" />

Finally, when your Job is complete, update the Job's status to `complete`. This status update includes an optional outcome message which will be displayed to the user.
Use this to provide detail on the outcome of the Job.

### Jobs.Complete

```jsx javascript
await api.jobs.complete(jobId, {
  outcome: {
    message: `Operation was completed succesfully. ${myData.length} records were processed.`,
  },
});
```

<Note>
  You can also use the [JobHandler Plugin](/plugins/core/job-handler) which
  simplifies the handling of Flatfile Jobs. This plugin works by listening to
  the `job:ready` event and executing the handler callback. There is an optional
  tick function which updates the Job's progress.
</Note>
