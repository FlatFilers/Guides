---
title: "Reuse an existing Space"
description: "Reuse a Space when Flatfile is opened."
icon: "recycle"
---

For synchronous data import/exchange completed in one session, create a new
Space each time Flatfile is opened. This suits situations where a clean slate
for every interaction is preferred. This will cover more topics for a more robust
embed than covered in the [quickstart](./new_space_quickstart.mdx). If you
don't need an advanced application, please try the quickstart guide first.

## Before you begin

<Snippet file="shared/pk_needed.mdx" />

## Prepare your project

Please be aware, this uses [Next.Js](https://nextjs.org/), a React Framework.
This functionality is able to be replecated in react, however it is more
diffcult to do so. This is because reusing spaces requires fetching of
potentially sensitive data, and requires your secret key. Next.js comes with
tools to quickly and easily create apis for your app, which we will be using here.

You can follow this tutorial to get started with flatfile, or piggyback
starting at step 2 to continue where the [new Space](./new_space.mdx)
tutorial ended. The other guide is not necessary to make this functionality work
however, so choose whatever suits your use-case.

### Install packages

Make a new directory.

```bash
mkdir example-flatfile-react-embed
```

Go into that directory.

```bash
cd example-flatfile-react-embed
```

Follow prompts from the `init` command.

```bash
npm init
```

Install packages.

```bash
npm i @flatfile/api @flatfile/listener @flatfile/react flatfile next react react-dom react-scripts tailwindcss postcss
```

```bash
npm i --save-dev @types/react daisyui
```

### Create your file structure

Setup your app to look something like this:

```plaintext
â”œâ”€â”€ app/
   â”œâ”€â”€ NewSpace/ - if you've already done the [new Space](./new_space.mdx) guide
     â””â”€â”€ index.tsx
   â”œâ”€â”€ ReuseSpace/
     â””â”€â”€ index.tsx     
   â”œâ”€â”€ Menu/
     â””â”€â”€ index.tsx    
   â”œâ”€â”€ listeners/
     â””â”€â”€ listeners.ts
   â”œâ”€â”€ workbooks/
     â””â”€â”€ workbooks.tsx
â”œâ”€â”€ pages/
   â”œâ”€â”€ api
     â”œâ”€â”€ spaces
       â””â”€â”€ [id].ts
   â”œâ”€â”€ new-spaces - if you've already done the [new Space](./new_space.mdx) guide
     â””â”€â”€ index.tsx
   â”œâ”€â”€ reuse-spaces
     â””â”€â”€ index.tsx    
   â”œâ”€â”€ _app.tsx
   â””â”€â”€ index.tsx
â”œâ”€â”€ .env
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json <--- already created
â””â”€â”€ package-lock.json <--- already created
```

In this file structure, your app should have two main directories, `app` and `pages`.

The `app` directory will contain the components for your react app, and this is
where you'll create the component to make a new space each time your importer
is opened.

The `pages` directory contains the routing and pages for your app.

## Build your importer

### 1. Create your layout, app, and index

Next.js relies on your layout and app files to drive the front end of the
application. Here we will add our app and layout components, as well as some
code for the index. We can also add some global styles here. The files containing
these updates are `app/Layout.tsx`, `pages/_app.tsx`, `pages/index.tsx`, and `app/global.css`.

<CodeGroup>

  ```ts app/Layout.tsx
    import Menu from './Menu';
    import './global.css';

    export const metadata = {
      title: "Embedded Flatfile in a Next.js App",
      description: "Generated by Flatfile",
    };

    export default function Layout({ children }: { children: React.ReactNode}) {
      return (
        <>
          <Menu />
          <main>
            {children}
          </main>
        </>
      )
    }
  ```

  ```ts pages/_app.tsx
    import Layout from '../app/Layout';

    export default function App({ Component, pageProps }: { Component: any, pageProps: any }) {
      return (
        <Layout>
          <Component {...pageProps} />
        </Layout>
      )
    }
  ```

  ```ts pages/index.tsx
    import Link from "next/link";
    import React from "react";

    export default function index(){
      return (
        <div className="hero min-h-screen">
          <div className="hero-content text-center">
            <div className="max-w-2xl">
              <h1 className="text-5xl font-bold">
                Welcome to Flatfile! <br /> We're glad you're here! ðŸ¤©
              </h1>
              <p className="py-6">
                This app will show you a few examples of how to integrate Embedded
                Flatfile into your React workflow. First, we'll show you how to
                create a new Space every time Flatfile is opened. Then, we'll show
                you how to reuse a Space when Flatfile is opened.
              </p>
              <Link href="/new-space">
                <button className="btn btn-primary">
                  Get Started Creating a New Space
                </button>
              </Link>
            </div>
          </div>
        </div>
      )
    }
  ```

  ```css app/global.css
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    :root {
      --ff-primary-color: #4c48ef !important;
      --ff-secondary-color: #616a7d !important;
      --ff-text-color: #090b2b !important;
      --ff-dialog-border-radius: 4px !important;
      --ff-border-radius: 5px !important;
      --ff-bg-fade: rgba(0, 0, 0, 0.2) !important;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: var(--ff-text-color);
      color: #fff;
    }

    pre {
      display: inline;
    }

    /* This class gets appended to the flatfile_iframe-wrapper div */
    .flatfile_displayAsModal {
      padding: 50px !important;
      width: calc(100%) !important;
      height: calc(100vh) !important;
    }

    .flatfile_iframe-wrapper.flatfile_displayAsModal {
      background: var(--ff-bg-fade);
    }

    /* The close button in top right to close modal */
    /* .flatfile_displayAsModal .flatfile_close-button {
    } */
    .flatfile_displayAsModal .flatfile-close-button {
      top: 30px ;
      right: 30px;
    }
    /* The icon for the close button in top right to close modal */
    .flatfile_displayAsModal .flatfile_close-button svg {
      fill: var(--ff-secondary-color);
    }

    /* The actual iframe that contains Flatfile */
    .flatfile_displayAsModal #flatfile_iframe {
      border-radius: var(--ff-border-radius);
    }

    /* Begin style overrides for when you cancel out of the Flatfile modal */

    /* The outer container of the modal that opens when you cancel out of Flatfile */
    .flatfile_outer-shell {
      background-color: var(--ff-bg-fade);
      border-radius: var(--ff-border-radius);
    }

    /* The inner container of the modal that opens when you cancel out of Flatfile */
    /* .flatfile_inner-shell {
    } */

    /* The white box inside the modal that opens when you cancel out of Flatfile */
    .flatfile_modal {
      border-radius: var(--ff-dialog-border-radius);
    }

    /* The container for the buttons you see in the close modal */
    /* .flatfile_button-group {
    } */

    /* Style the buttons you see in the close modal */
    /* .flatfile_button {
    } */

    /* The "yes, cancel" button you see in the close modal */
    .flatfile_primary {
      border: 1px solid var(--ff-primary-color) !important;
      background-color: var(--ff-primary-color) !important;
      color: #fff !important;
    }

    /* The "no, stay" button you see in the close modal */
    .flatfile_secondary {
      color: var(--ff-secondary-color) !important;
    }

    /* The heading text you see in the close modal */
    .flatfile_modal-heading {
      color: var(--ff-text-color) !important;
    }

    /* The description text you see in the close modal */
    .flatfile_modal-text {
      color: var(--ff-secondary-color) !important;
    }

    .alert a {
      text-decoration: underline;
    }

    /* End style overrides for when you cancel out of the Flatfile modal */

    /* End style overrides for when Flatfile is displayed as a modal */

    /* The container of the error component */
    /* .ff_error_container {
    }*/

    /* The heading text you see in the error component */
    /* .ff_error_heading {
    }*/

    /* The description text you see in the error component */
    /* .ff_error_text {
    }*/

  ```

</CodeGroup>

### 2. Add a Flatfile button

Now that your app has its layout, we can start building the page to create new
spaces! Start by creating the `ReuseSpace` component at `app/ReuseSpace/index.tsx`
Note that because the component file is titled `index`, when importing we can
simply point to the directory, and don't need to specify the file.

  ```ts app/ReuseSpace/index.tsx
    "use client";
    import { ISpace, useSpace } from "@flatfile/react";
    import React, { Dispatch, SetStateAction, useEffect, useState } from "react";

    const Space = ({
      setShowSpace,
      config,
    }: {
      setShowSpace: Dispatch<SetStateAction<boolean>>;
      config: {
        spaceId: string;
        environmentId: string;
        accessToken: string;
      };
    }) => {
      const spaceProps: ISpace = {
        environmentId: config.environmentId,
        space: {
          id: config.spaceId,
          accessToken: config.accessToken,
        },
      };
      const space = useSpace({
        ...spaceProps,
        closeSpace: {
          operation: "contacts:submit",
          onClose: () => setShowSpace(false),
        },
      });
      return space;
    };

    export default function ReuseSpace({
      spaceId,
      environmentId,
    }: {
      spaceId?: string;
      environmentId?: string;
    }) {
      const [showSpace, setShowSpace] = useState(false);
      const [loading, setLoading] = useState(true);
      const [data, setData] = useState<any>();
      const [error, setError] = useState<any>();

      useEffect(() => {
        const fetchData = async (spaceId: string) => {
          const response = await fetch(`/api/spaces/${spaceId}`);
          const json = await response.json();
          if (json.error) {
            setError(json.error);
            setLoading(false);
            return;
          }
          const spaceInfo = {
            spaceId,
            accessToken: json.space.data.accessToken,
            environmentId,
          };

          setData(spaceInfo);
          setLoading(false);
        };

        if (!spaceId || !environmentId) {
          setLoading(false);
          return;
        }

        fetchData(spaceId).catch((err) => {
          setLoading(false);
          setError(err);
        });
      }, [spaceId, environmentId]);

      if (loading) {
        return (
          <button className="btn">
            <span className="loading loading-spinner"></span>
            loading
          </button>
        );
      }
      if (!spaceId || !environmentId || error) {
        return (
          <div className="alert alert-error">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="stroke-current shrink-0 h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="2"
                d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span className="flex-col">
              {(!spaceId || !environmentId) && (
                <span>
                  Please add a <pre>spaceId</pre> and <pre>environmentId</pre>
                </span>
              )}
              {error && (
                <span>
                  {error} Make sure to set the <pre>FLATFILE_API_KEY</pre> in your{" "}
                  <pre>.env</pre> file. <br />
                  You can find that in your Flatfile Dashboard under Developer
                  Settings.
                </span>
              )}
            </span>
          </div>
        );
      }

      return (
        <div>
          <div>
            <button
              className="btn btn-primary"
              onClick={() => {
                setShowSpace(!showSpace);
              }}
            >
              {showSpace === true ? "Close" : "Open existing"} space
            </button>
          </div>
          {showSpace && (
            <div id="flatfile_iFrameContainer">
              {data?.accessToken ? (
                <Space setShowSpace={setShowSpace} config={data} />
              ) : (
                <div className="alert alert-error">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="stroke-current shrink-0 h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth="2"
                      d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  <span>No access token available.</span>
                </div>
              )}
            </div>
          )}
        </div>
      );
    }

  ```

Note that the internal api is used in this component. Let's set that up now so
that it will function. This will require that your secret key be included in your
environment variables as `FLATFILE_API_KEY`. Please add that now as well to
ensure your api will function as intended.

<CodeGroup>

  ```ts pages/api/spaces/[id].ts
      import api from "@flatfile/api";
    import { NextApiRequest, NextApiResponse } from "next";

    export default async function handler(req: NextApiRequest, res: NextApiResponse) {
      const { id } = req.query;
      try {
        if(!id || typeof id !== 'string') throw new Error("No space ID provided");
        const space = await api.spaces.get(id);
        res.json({ space });
      } catch (error) {
        console.error("Error retrieving space:", error);
        res.status(500).json({ error: "Failed to retrieve space" });
      }
    }
  ```

  ```bash .env
    # your secret key here
    FLATFILE_API_KEY=sk_123456
  ```

</CodeGroup>

### 3. Initialize Flatfile

Next we can create the page that will house this component.

For this section you will need to have the `spaceId` of the space you want to
reuse, and the `environmentId`. You can access your `environmentId` when logged
in to [platform.flatfile.com](platform.flatfile.com) under "developer settings".
As for the `spaceId`, this should be visible next to any space in "All Spaces"
when you're logged into [platform.flatfile.com](platform.flatfile.com)

This page for reusing spaces will be housed at `pages/reuse-space/index.tsx`,
and Next will automatically route you to this page when you visit `yourappsdomain/reuse-space`!

<CodeGroup>

  ```ts pages/reuse-space/index.tsx
    "use client";
    import React from "react";
    import ReuseSpace from "../../app/ReuseSpace";

    export default function reuseSpace() {
      return (
        <div className="container px-20 pt-20">
          <h2 className="text-2xl font-bold mb-4">Reuse an existing Space</h2>
          <p>
            Reuse a Space when users might need to wait or canâ€™t finish in one go.
            Itâ€™s great for keeping work context and letting users continue where
            they left off until the task is done.
          </p>
          <div className="py-10">
            <ReuseSpace spaceId={""} environmentId={""} />
          </div>
        </div>
      );
    }

  ```

</CodeGroup>

### 4. Start your client

Everything you need to start importing and transforming data is now included in
your app. If you haven't started it already, now is a great time to do so! you
can make that process easier by updating your `package.json` to include these
scripts:

```json package.json
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
```

```bash
npm run dev
```

You should get a message in your terminal that looks something like this:

```bash
  â–² Next.js 14.0.4
  - Local:        http://localhost:1111
  - Environments: .env
```

If you see this that means you've been successful, and you can visit your app at
the url provided!

### 5. Add customizations

You can stop here or you can [view our full reference](../reference/common) to
see all the ways you can customize your importer.

## Example Project

Find this Nextjs example, and a simplified React example project in the 
Flatfile GitHub repository.

<CardGroup cols={2}>
  <Card
    title="flatfile-nextjs"
    icon="star"
    href="https://github.com/FlatFilers/flatfile-nextjs"
  >
    Clone the Flatfile Nextjs tutorial from here.
  </Card>
    <Card
    title="create-flatfile-react"
    icon="react"
    href="https://github.com/FlatFilers/create-flatfile-react"
  >
    Alternately, clone the simplified Flatfile React example here.
  </Card>
  
</CardGroup>
