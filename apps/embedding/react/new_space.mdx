---
title: "Embed a new Space"
description: "Create a new Space every time Flatfile is opened."
icon: "plus"
---

For synchronous data import/exchange completed in one session, create a new
Space each time Flatfile is opened. This suits situations where a clean slate
for every interaction is preferred. This will cover more topics for a more robust
embed than covered in the [quickstart](./new_space_quickstart.mdx). If you
don't need an advanced application, please try the quickstart guide first.

## Before you begin

<Snippet file="shared/pk_needed.mdx" />

## Prepare your project

Please be aware, this uses [Next.Js](https://nextjs.org/), a React Framework.
This functionality is able to be replecated in react, however for the other half
of an advanced flatfile application - [reusing Spaces](./reuse_space.mdx) - we
will benefit from the SSR functionality built-in to next.

### Install packages

Make a new directory.

```bash
mkdir example-flatfile-react-embed
```

Go into that directory.

```bash
cd example-flatfile-react-embed
```

Follow prompts from the `init` command.

```bash
npm init
```

Install packages.

```bash
npm i @flatfile/api @flatfile/listener @flatfile/react flatfile next react react-dom react-scripts tailwindcss postcss
```

```bash
npm i --save-dev @types/react daisyui
```

### Create your file structure

Setup your app to look something like this:

```plaintext
  â”œâ”€â”€ app/
    â”œâ”€â”€ NewSpace/
      â””â”€â”€ index.tsx
    â”œâ”€â”€ Menu/
      â””â”€â”€ index.tsx    
    â”œâ”€â”€ listeners/
      â””â”€â”€ listeners.ts
    â”œâ”€â”€ workbooks/
      â””â”€â”€ workbooks.tsx
  â”œâ”€â”€ pages/
    â”œâ”€â”€ new-spaces
      â””â”€â”€ index.tsx
    â”œâ”€â”€ _app.tsx
    â””â”€â”€ index.tsx
  â”œâ”€â”€ tsconfig.json
  â”œâ”€â”€ package.json <--- already created
  â””â”€â”€ package-lock.json <--- already created
```

In this file structure, your app should have two main directories, `app` and `pages`.

The `app` directory will contain the components for your react app, and this is
where you'll create the component to make a new space each time your importer
is opened.

The `pages` directory contains the routing and pages for your app.

## Build your importer

### 1. Create your layout, app, and index

Next.js relies on your layout and app files to drive the front end of the
application. Here we will add our app and layout components, as well as some
code for the index. We can also add some global styles here. The files containing
these updates are `app/Layout.tsx`, `pages/_app.tsx`, `pages/index.tsx`, and `app/global.css`.

<CodeGroup>

  ```ts app/Layout.tsx
    import Menu from './Menu';
    import './global.css';

    export const metadata = {
      title: "Embedded Flatfile in a Next.js App",
      description: "Generated by Flatfile",
    };

    export default function Layout({ children }: { children: React.ReactNode}) {
      return (
        <>
          <Menu />
          <main>
            {children}
          </main>
        </>
      )
    }
  ```

  ```ts pages/_app.tsx
    import Layout from '../app/Layout';

    export default function App({ Component, pageProps }: { Component: any, pageProps: any }) {
      return (
        <Layout>
          <Component {...pageProps} />
        </Layout>
      )
    }
  ```

  ```ts pages/index.tsx
    import Link from "next/link";
    import React from "react";

    export default function index(){
      return (
        <div className="hero min-h-screen">
          <div className="hero-content text-center">
            <div className="max-w-2xl">
              <h1 className="text-5xl font-bold">
                Welcome to Flatfile! <br /> We're glad you're here! ðŸ¤©
              </h1>
              <p className="py-6">
                This app will show you a few examples of how to integrate Embedded
                Flatfile into your React workflow. First, we'll show you how to
                create a new Space every time Flatfile is opened. Then, we'll show
                you how to reuse a Space when Flatfile is opened.
              </p>
              <Link href="/new-space">
                <button className="btn btn-primary">
                  Get Started Creating a New Space
                </button>
              </Link>
            </div>
          </div>
        </div>
      )
    }
  ```

  ```css app/global.css
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    :root {
      --ff-primary-color: #4c48ef !important;
      --ff-secondary-color: #616a7d !important;
      --ff-text-color: #090b2b !important;
      --ff-dialog-border-radius: 4px !important;
      --ff-border-radius: 5px !important;
      --ff-bg-fade: rgba(0, 0, 0, 0.2) !important;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: var(--ff-text-color);
      color: #fff;
    }

    pre {
      display: inline;
    }

    /* This class gets appended to the flatfile_iframe-wrapper div */
    .flatfile_displayAsModal {
      padding: 50px !important;
      width: calc(100%) !important;
      height: calc(100vh) !important;
    }

    .flatfile_iframe-wrapper.flatfile_displayAsModal {
      background: var(--ff-bg-fade);
    }

    /* The close button in top right to close modal */
    /* .flatfile_displayAsModal .flatfile_close-button {
    } */
    .flatfile_displayAsModal .flatfile-close-button {
      top: 30px ;
      right: 30px;
    }
    /* The icon for the close button in top right to close modal */
    .flatfile_displayAsModal .flatfile_close-button svg {
      fill: var(--ff-secondary-color);
    }

    /* The actual iframe that contains Flatfile */
    .flatfile_displayAsModal #flatfile_iframe {
      border-radius: var(--ff-border-radius);
    }

    /* Begin style overrides for when you cancel out of the Flatfile modal */

    /* The outer container of the modal that opens when you cancel out of Flatfile */
    .flatfile_outer-shell {
      background-color: var(--ff-bg-fade);
      border-radius: var(--ff-border-radius);
    }

    /* The inner container of the modal that opens when you cancel out of Flatfile */
    /* .flatfile_inner-shell {
    } */

    /* The white box inside the modal that opens when you cancel out of Flatfile */
    .flatfile_modal {
      border-radius: var(--ff-dialog-border-radius);
    }

    /* The container for the buttons you see in the close modal */
    /* .flatfile_button-group {
    } */

    /* Style the buttons you see in the close modal */
    /* .flatfile_button {
    } */

    /* The "yes, cancel" button you see in the close modal */
    .flatfile_primary {
      border: 1px solid var(--ff-primary-color) !important;
      background-color: var(--ff-primary-color) !important;
      color: #fff !important;
    }

    /* The "no, stay" button you see in the close modal */
    .flatfile_secondary {
      color: var(--ff-secondary-color) !important;
    }

    /* The heading text you see in the close modal */
    .flatfile_modal-heading {
      color: var(--ff-text-color) !important;
    }

    /* The description text you see in the close modal */
    .flatfile_modal-text {
      color: var(--ff-secondary-color) !important;
    }

    .alert a {
      text-decoration: underline;
    }

    /* End style overrides for when you cancel out of the Flatfile modal */

    /* End style overrides for when Flatfile is displayed as a modal */

    /* The container of the error component */
    /* .ff_error_container {
    }*/

    /* The heading text you see in the error component */
    /* .ff_error_heading {
    }*/

    /* The description text you see in the error component */
    /* .ff_error_text {
    }*/

  ```

</CodeGroup>

### 2. Add a Flatfile button 

Now that your app has its layout, we can start building the page to create new
spaces! Start by creating the `NewSpace` component at `app/NewSpace/index.tsx`
Note that because the component file is titled `index`, when importing we can
simply point to the directory, and don't need to specify the file.

<CodeGroup>

  ```ts app/NewSpace/index.tsx
    "use client";
    import { ISpace, useSpace } from "@flatfile/react";
    import Link from "next/link";
    import React, { Dispatch, SetStateAction, useState } from "react";

    const Space = ({
      callback,
      config,
    }: {
      callback: () => void;
      config: ISpace;
    }) => {
      const space = useSpace({
        ...config,
        closeSpace: {
          operation: "contacts:submit",
          onClose: () => callback(),
        },
      });
      return space;
    };


    export default function NewSpace({ config }: { config: ISpace }) {
      const [showSpace, setShowSpace] = useState(false);
      const [success, setSuccess] = useState(false);
      const credentials = !!config.publishableKey && !!config.environmentId;
      return (
        <div>
          {credentials ? (
            <>
              <div>
                <button
                  className="btn btn-primary"
                  onClick={() => {
                    setShowSpace(!showSpace);
                  }}
                >
                  {showSpace === true ? "Close" : "Open and create new"} space
                </button>
              </div>
              {showSpace && (
                <div id="flatfile_iFrameContainer">
                  <Space
                    callback={() => {
                      setShowSpace(false);
                      setSuccess(true);
                    }}
                    config={config}
                  />
                </div>
              )}
            </>
          ) : (
            <div className="alert alert-error">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                className="stroke-current shrink-0 h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="2"
                  d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              <span>
                Error! Please add your <pre>publishableKey</pre> and{" "}
                <pre>environmentId</pre>
              </span>
            </div>
          )}
          {success && (
            <div className="alert alert-success mt-6">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                className="stroke-current shrink-0 h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth="2"
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              <span>
                Great Success! Now you might want to try out reusing a space,{" "}
                <Link href="/reused-space">check out the next example here.</Link>
              </span>
            </div>
          )}
        </div>
      );
    }

  ```

</CodeGroup>

### 3. Initialize Flatfile

Next we can create the page that will house this component. Please note that on
this page we will be using the workbook and listeners, but as we have not
defined those yet there will be errors. We will define those in a little bit,
so you can either comment out those lines or keep working through this guide
until they are defined.

For this section you will need to have your `publishableKey` and `environmentId`,
you can access these when logged in to [platform.flatfile.com](platform.flatfile.com)
under "developer settings".

This page for creating new spaces will be housed at `pages/new-space/index.tsx`,
and Next will automatically route you to this page when you visit `yourappsdomain/new-space`!

<CodeGroup>

  ```ts pages/new-space/index.tsx
    import { ISpace } from "@flatfile/react";
    import React from "react";
    import NewSpaceApp from "../../app/NewSpace";
    import { listener } from "../../app/listeners/listeners";
    import { workbook } from "../../app/workbooks/workbooks";
    const spaceProps: ISpace = {
      name: "Embedded Space",
      // to test locally add your publishableKey here, for example: pk_12345,
      publishableKey: "pk_12345",
      // to test locally add your environmentId here, for example: us_env_12345,
      environmentId: "us_env_12345",
      workbook,
      listener,
      // themeConfig: makeTheme({ primaryColor: "#546a76", textColor: "#fff" }),
      // sidebarConfig: {
      //   showDataChecklist: false,
      //   showSidebar: false,
      // },
    };

    export default function newSpace(){
      return (
        <div className="container px-20 pt-20">
          <h2 className="text-2xl font-bold mb-4">
            Embed a new Space every time Flatfile is opened
          </h2>
          <p>
            Reuse a Space when users might need to wait or canâ€™t finish in one go.
            Itâ€™s great for keeping work context and letting users continue where
            they left off until the task is done.
          </p>
          <div className="py-10">
            <NewSpaceApp config={spaceProps} />
          </div>
        </div>
      )
    }
  ```

</CodeGroup>

### 4. Start your client

Everything you need to start importing and transforming data is now included in
your app. If you haven't started it already, now is a great time to do so! you
can make that process easier by updating your `package.json` to include these
scripts:

```json package.json
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
```

```bash
npm run dev
```

You should get a message in your terminal that looks something like this:

```bash
  â–² Next.js 14.0.4
  - Local:        http://localhost:1111
  - Environments: .env
```

If you see this that means you've been successful, and you can visit your app at
the url provided!

### 5. Build your Workbook and Listeners

Now your app is set up and will work on its own if workbook and listener are
commented out. A space with no workbook or listeners isn't that useful though,
so lets add those now.

<CodeGroup>

  ```ts app/workbooks/workbooks.ts
    import { Flatfile } from '@flatfile/api';

    export const workbook: Pick<
      Flatfile.CreateWorkbookConfig,
      'name' | 'labels' | 'sheets' | 'actions'
    > = {
      name: 'All Data',
      labels: ['pinned'],
      sheets: [
        {
          name: 'Contacts',
          slug: 'contacts',
          allowAdditionalFields: true,
          fields: [
            {
              key: 'firstName',
              type: 'string',
              label: 'First Name'
            },
            {
              key: 'lastName',
              type: 'string',
              label: 'Last Name'
            },
            {
              key: 'email',
              type: 'string',
              label: 'Email'
            }
          ]
        }
      ],
      actions: [
        {
          operation: 'submitActionFg',
          mode: 'foreground',
          label: 'Submit foreground',
          description: 'Submit data to webhook.site',
          primary: true
        }
      ]
    };
  ```

  ```ts app/listeners/listeners.ts
    import api from '@flatfile/api';
    import { FlatfileListener } from '@flatfile/listener';
    import { recordHook } from '@flatfile/plugin-record-hook';

    /**
     * Example Listener
     */
    export const listener = FlatfileListener.create((listener) => {
      listener.on('**', (event) => {
        console.log(`Received event: ${event.topic}`);
      });

      listener.use(
        recordHook('contacts', (record) => {
          const firstName = record.get('firstName');
          console.log({ firstName });
          record.set('lastName', 'Rock');
          return record;
        })
      );

      listener.filter({ job: 'workbook:submitActionFg' }, (configure) => {
        configure.on('job:ready', async ({ context: { jobId } }) => {
          try {
            await api.jobs.ack(jobId, {
              info: 'Getting started.',
              progress: 10
            });

            // Make changes after cells in a Sheet have been updated
            console.log('Make changes here when an action is clicked');

            await api.jobs.complete(jobId, {
              outcome: {
                acknowledge: true,
                message: 'This is now complete.',
                next: {
                  type: 'wait'
                }
              }
            });
          } catch (error: any) {
            console.error('Error:', error.stack);

            await api.jobs.fail(jobId, {
              outcome: {
                message: 'This job encountered an error.'
              }
            });
          }
        });
      });
    });


  ```

</CodeGroup>

Now if you go and add workbook and listener to your `pages/new-space/index.tsx`
you can open the space with your desired schema and listeners!

### 6. Match your Brand

By attaching a `themeConfig`, we will now override colors in your Space to match
your brand. See all of the options here in the [Theming Reference](/guides/theming).

```ts pages/new-space/index.tsx
  import { ISpace, makeTheme } from "@flatfile/react";
  import React from "react";
  import NewSpaceApp from "../../app/NewSpace";
  import { listener } from "../../app/listeners/listeners";
  import { workbook } from "../../app/workbooks/workbooks";
  const spaceProps: ISpace = {
    name: "Embedded Space",
    // to test locally add your publishableKey here, for example: pk_12345,
    publishableKey: "pk_6e0577bd434b4f989c3add5ad4d9feaf",
    // to test locally add your environmentId here, for example: us_env_12345,
    environmentId: "us_env_1ejus9hB",
    workbook,
    listener,
    themeConfig: makeTheme({ primaryColor: "#546a76", textColor: "#fff" }),
    sidebarConfig: {
      showDataChecklist: false,
      showSidebar: false,
    },
  };

  export default function newSpace(){
    return (
      <div className="container px-20 pt-20">
        <h2 className="text-2xl font-bold mb-4">
          Embed a new Space every time Flatfile is opened
        </h2>
        <p>
          Reuse a Space when users might need to wait or canâ€™t finish in one go.
          Itâ€™s great for keeping work context and letting users continue where
          they left off until the task is done.
        </p>
        <div className="py-10">
          <NewSpaceApp config={spaceProps} />
        </div>
      </div>
    )
  }
```

### 7. Add customizations

You can stop here or you can [view our full reference](../reference/common) to
see all the ways you can customize your importer.

## Example Project

Find this Nextjs example, and a simplified React example project in the 
Flatfile GitHub repository.

<CardGroup cols={2}>
  <Card
    title="flatfile-nextjs"
    icon="star"
    href="https://github.com/FlatFilers/flatfile-nextjs"
  >
    Clone the Flatfile Nextjs tutorial from here.
  </Card>
    <Card
    title="create-flatfile-react"
    icon="react"
    href="https://github.com/FlatFilers/create-flatfile-react"
  >
    Alternately, clone the simplified Flatfile React example here.
  </Card>
</CardGroup>
